<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Google Maps Smoke Test</title>
    <style>
      html, body { margin: 0; padding: 0; }
      #map { width: 100%; height: 360px; background: #f3f4f6; }
      #log { font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial; padding: 12px; }
      .err { color: #b91c1c; }
      .ok  { color: #065f46; }
    </style>
  </head>
  <body>
    <h3 style="margin:12px">Google Maps Smoke Test</h3>
    <div id="map"></div>
    <pre id="log"></pre>

    <script>
      // change this line ONLY:
      const KEY = 'AIzaSyBl6Kff-8059YzfExtdAo7BTy1AXfe1JTs';

      function log(msg, ok = false) {
        const el = document.getElementById('log');
        el.innerHTML += (ok ? '✅ ' : '❌ ') + msg + '\n';
        if (!ok) el.classList.add('err');
        else el.classList.add('ok');
      }

      window.initMap = function () {
        try {
          log('initMap() called', true);
          if (!window.google || !window.google.maps) {
            log('window.google.maps missing after load');
            return;
          }
          const map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: 1.3521, lng: 103.8198 },
            zoom: 12,
            streetViewControl: false,
            mapTypeControl: false
          });
          new google.maps.Marker({
            position: { lat: 1.35, lng: 103.82 },
            map,
            title: 'SG'
          });
          log('Map created OK', true);
        } catch (e) {
          log('initMap error: ' + (e && e.message ? e.message : e));
        }
      };
    </script>

    <!-- Load the JS API with the classic callback (no importLibrary, no custom loader) -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=KEY_REPLACED&v=weekly&callback=initMap"
      async
      defer
      onerror="document.getElementById('log').innerHTML += '❌ Script tag onerror (network/CSP)\n'">
    </script>

    <script>
      // Replace KEY in the src
      (function fixSrc() {
        const s = document.currentScript.previousElementSibling; // the Google Maps script tag
        s.src = s.src.replace('KEY_REPLACED', KEY);
      })();
    </script>
  </body>
</html>